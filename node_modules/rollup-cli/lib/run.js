const fs = require('fs');
const path = require('path');
const inquirer = require('inquirer');
const chalk = require('chalk');
const gitUser = require('./git-user');
const copy = require('./copy');

module.exports = (projectName) => {
  inquirer.prompt([
    {
      type: 'input',
      name: 'name',
      message: 'Project name',
      default: projectName
    },
    {
      type: 'input',
      name: 'description',
      message: 'Project description',
      default: 'A project build by rollup-cli.'
    },
    {
      type: 'input',
      name: 'author',
      message: 'Project author',
      default: gitUser()
    },
    {
      type: 'input',
      name: 'keywords',
      message: 'Project keywords (split by ",")',
      default: 'rollup-cli'
    }
  ]).then(answers => {
    const originPath = path.join(__dirname, '../template');
    const targetPath = path.join(projectName);
    fs.mkdirSync(targetPath);

    let tplPkg = require('../template/package.json');
    tplPkg.name = answers.name;
    tplPkg.description = answers.description;
    tplPkg.author = answers.author;
    tplPkg.keywords = answers.keywords.split(',');

    const readme = `# ${answers.name}\n\n${answers.description}`;

    fs.writeFileSync(path.join(targetPath, 'package.json'), JSON.stringify(tplPkg, null, 2), { encoding: 'utf8' });
    fs.writeFileSync(path.join(targetPath, 'README.md'), readme, { encoding: 'utf8' });

    copy(originPath, targetPath);

    console.log('\nThe project is created, now you should install packages\n');
    console.log('    ' + chalk.inverse(`cd ${projectName} && npm install`));
    console.log('\nDevelopment: ' + chalk.cyan('npm run dev'));
    console.log('Production:  ' + chalk.cyan('npm run build'));
  });
}